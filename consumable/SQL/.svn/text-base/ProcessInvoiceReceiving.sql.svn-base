IF @RECEIVED_STATUS = 'ACCEPT'
BEGIN 
	UPDATE 
		TB_R_INVOICE
	SET 
		RECEIVED_STATUS = @RECEIVED_STATUS		
		,RECEIVED_DT =  getdate()
		,PAYMENT_PLAN_DATE = (SELECT TOP 1 WORKING_DATE     
							  FROM TB_M_WORKING_CALENDAR
							  where WORKING_DATE >= @PAYMENT_PLAN_DATE
							  and WORKING_FLAG = '1'
							  order by WORKING_DATE asc)
		,[STATUS] = 'SUBMITTED'
		,SUBMIT_DT = getdate()
		,SUBMIT_BY = @UPDATED_BY
		,UPDATED_DT = getdate()
		,UPDATED_BY = @UPDATED_BY
	WHERE
		1 = 1
		and CERTIFICATE_ID = @CERTIFICATE_ID

END

IF @RECEIVED_STATUS = 'REJECT'
BEGIN 
	UPDATE 
		TB_R_INVOICE
	SET 
		RECEIVED_STATUS = @RECEIVED_STATUS
		,RECEIVED_DT =  getdate()
		,[STATUS] = 'REJECTED'
		,NOTICE_DATE = CAST(CONVERT(datetime,  @NOTICE_DATE , 104) as DATE)
		,NOTICE_REMARK = @NOTICE_REMARK
		,NOTICE_BY = @NOTICE_BY
		,UPDATED_DT = getdate()
		,UPDATED_BY = @UPDATED_BY
	WHERE 
		1 = 1
		and CERTIFICATE_ID = @CERTIFICATE_ID

END